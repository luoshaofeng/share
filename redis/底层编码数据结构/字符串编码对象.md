# 字符串编码对象

字符串的编码对象有两种：`EmbeddedString` 和 `RawString`

- EmbeddedString

  EmbeddedString是针对string小对象的优化，使得redisObject整个对象的字节数小于或等于64字节，小对象只需要申请一次内存，并且整个对象能够整个放入到cache line中，提高性能

- RawString

  与EmbeddedString不同，RawString的redisObject对象和sds对象的内存申请是分开的



# 数据结构

不管是`EmbeddedString`还是`RawString`，string对象用的数据结构都是一样的，区别只在于分配的内存地址是不是跟redisObject连续的

```c
struct __attribute__ ((__packed__)) sdshdr8 {
    // 字符串已使用的长度
    uint8_t len;
    // 字符串分配的空间
    uint8_t alloc;
    // 只使用到低3位
    unsigned char flags;
    // 实际保存字符串的内存
    char buf[];
};
```

字符串定义了多个sds（sdshdr8，sdshdr16，sdshdr32，sdshdr64）类型，主要针对不同的字符串大小，来针对`len`和`alloc`字段，使用不同的字节大小的int类型。

len：表示分配的buf已使用的内存空间

alloc：表示分配的buf申请的内存空间

flags：表示使用的是哪种sds类型：sdshdr8，sdshdr16，sdshdr32，sdshdr64

buf：指向实际保存字符串的内存空间